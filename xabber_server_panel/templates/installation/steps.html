{% extends 'base.html' %}
{% load static %}

{% block body %}
    <body class="d-flex flex-column min-vh-100 vh-100 bg-body bg-opacity-75">
        <div class="container flex-md-grow-1">
            <div class="row h-100">
                <main class="px-md-4 py-4">
                    <div class="d-flex align-items-center mb-4 fs-4">
                        <img src="{% static 'img/logo.png' %}" width="48" height="48" alt="Xabber">
                        Xabber server installation
                    </div>

                    <div class="col-12">
                        <form method="POST" novalidate>
                            {% csrf_token %}

                            <div class="bs-stepper">
                                <div class="bs-stepper-header" role="tablist">
                                    <div class="step {% if step == '1' %}active{% endif %}" data-target="#host_tab">
                                        <button type="button" class="step-trigger" role="tab" aria-controls="host_tab" id="host_tab-trigger">
                                            <span class="bs-stepper-circle">1</span>
                                            <span class="bs-stepper-label">XMPP host</span>
                                        </button>
                                    </div>

                                    <div class="line"></div>

                                    <div class="step {% if step == '2' %}active{% endif %}" data-target="#admin_settings">
                                        <button type="button" class="step-trigger" role="tab" aria-controls="admin_settings" id="admin_settings-trigger">
                                            <span class="bs-stepper-circle">2</span>
                                            <span class="bs-stepper-label">Admin settings</span>
                                        </button>
                                    </div>

                                    <div class="line"></div>

                                    <div class="step {% if step == '3' %}active{% endif %}" data-target="#database_settings">
                                        <button type="button" class="step-trigger" role="tab" aria-controls="database_settings" id="database_settings-trigger">
                                            <span class="bs-stepper-circle">3</span>
                                            <span class="bs-stepper-label">Database settings</span>
                                        </button>
                                    </div>

                                    <div class="line"></div>

                                    <div class="step {% if step == '4' %}active{% endif %}" data-target="#installation">
                                        <button type="button" class="step-trigger" role="tab" aria-controls="installation" id="installation-trigger">
                                            <span class="bs-stepper-circle">4</span>
                                            <span class="bs-stepper-label">Installation</span>
                                        </button>
                                    </div>
                                </div>

                                <div class="bs-stepper-content">
                                    <div id="host_tab" class="content {% if step == '1' %}active{% endif %}" role="tabpanel" aria-labelledby="host_tab-trigger">
                                        <div>
                                        Configure main domain name for the XMPP server.
                                        It will be used to access server from the internet.
                                        All users will receive accounts in this domain.
                                        You must have access to DNS settings for this domain to make it work.
                                        </div>

                                        <div>
                                        <label class="{% if form.host.errors %}error{% endif %}">
                                        {{ form.host.label }}
                                        {{ form.host }}
                                        </label>
                                        </div>

                                        <button class="btn btn-primary" type="submit">
                                            Next
                                        </button>
                                    </div>
                                    <div id="admin_settings" class="content {% if step == '2' %}active{% endif %}" role="tabpanel" aria-labelledby="admin_settings-trigger">
                                        <div>
                                            Configure admin account for the server.
                                            It will be used to perform all administration and maintenance operations with the server.
                                            You will be able to chat using this account, you will also receive security alerts from the server.
                                            You will be able to configure additional admin accounts later.
                                        </div>

                                        <div>
                                            <label class="{% if form.username.errors %}error{% endif %}">
                                                {{ form.username.label }}
                                                {{ form.username }}
                                            </label>

                                            <label class="{% if form.password.errors %}error{% endif %}">
                                                {{ form.password.label }}
                                                {{ form.password }}
                                            </label>
                                        </div>

                                        <button class="btn btn-primary" type="submit" name="previous" value="1">
                                            Previous
                                        </button>
                                        <button class="btn btn-primary" type="submit">
                                            Next
                                        </button>
                                    </div>
                                    <div id="database_settings" class="content {% if step == '3' %}active{% endif %}" role="tabpanel" aria-labelledby="database_settings-trigger">
                                        <div>
                                            Connect server to a database.
                                            You must have it preconfigured before proceeding with installation.
                                            Database installation instruction can be found
                                            <a href="https://github.com/redsolution/xabber-server/wiki/Installation#postgresql-installation">here</a>.
                                        </div>

                                        <div>
                                            <label class="{% if form.server_name.errors %}error{% endif %}">
                                                {{ form.db_host.label }}
                                                {{ form.db_host }}
                                            </label>

                                            <label class="{% if form.db_name.errors %}error{% endif %}">
                                                {{ form.db_name.label }}
                                                {{ form.db_name }}
                                            </label>

                                            <label class="{% if form.db_user.errors %}error{% endif %}">
                                                {{ form.db_user.label }}
                                                {{ form.db_user }}
                                            </label>

                                            <label class="{% if form.db_user_password.errors %}error{% endif %}">
                                                {{ form.db_user_pass.label }}
                                                {{ form.db_user_pass }}
                                            </label>
                                        </div>

                                        <button class="btn btn-primary" type="submit" name="previous" value="2">
                                            Previous
                                        </button>
                                        <button class="btn btn-primary" type="submit">
                                            Next
                                        </button>
                                    </div>
                                    <div id="installation" class="content {% if step == '4' %}active{% endif %}" role="tabpanel" aria-labelledby="installation-trigger">
                                        {% if installation_error %}
                                            {{ installation_error }}
                                            <button type="submit" name="previous" value="3">
                                                Previous
                                            </button>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </main>
            </div>
        </div>
    </body>
{% endblock %}